<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PowerKeyRules WebUI</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <main class="shell">
    <section class="card">
      <header class="header">
        <div>
          <p class="eyebrow">LSPosed · Zygisk</p>
          <h1>PowerKeyRules</h1>
          <p class="subtitle">可视化配置物理按键规则，无需直接编辑 JSON。</p>
        </div>
        <div class="badge">WebUI</div>
      </header>

      <div class="row path-row hidden">
        <label for="rulesPath">規則檔案路徑</label>
        <input id="rulesPath" type="text" />
        <button id="btnLoad">從磁碟讀取</button>
        <button id="btnSave">保存到磁碟</button>
      </div>

      <section class="config">
        <div class="config-field">
          <label for="doubleInterval">双击间隔 (ms)</label>
          <input id="doubleInterval" type="number" min="100" max="1000" step="10" />
        </div>
        <div class="config-field">
          <label for="longPressMin">长按最短阈值 (ms)</label>
          <input id="longPressMin" type="number" min="200" max="4000" step="50" />
        </div>
        <div class="config-field info">
          <p class="hint">提示：规则可设置更高的 durationMs，系统会匹配小于等于实际时长的最大阈值。</p>
        </div>
      </section>

      <section class="rules">
        <div class="rules-header">
          <h2>规则列表</h2>
          <div class="rules-actions">
            <button id="btnAddNew">添加规则</button>
            <button id="btnDefault">载入默认模板</button>
            <button id="btnReload">重新读取</button>
          </div>
        </div>
        <div id="ruleList" class="rule-list empty">
          <p class="muted">暂无规则，点击“添加规则”开始。</p>
        </div>
      </section>

      <section class="editor">
        <h3 id="formTitle">添加规则</h3>
        <form id="ruleForm">
          <div class="form-grid">
            <label>物理按键
              <div class="key-row">
                <select id="keySelect"></select>
                <input id="keyCodeCustom" type="number" min="0" placeholder="其它键码" class="hidden" />
              </div>
            </label>
            <label>触发行为
              <select id="behavior">
                <option value="DOWN">按下</option>
                <option value="UP">松开</option>
                <option value="LONG_PRESS">长按</option>
                <option value="DOUBLE_PRESS">双击</option>
              </select>
            </label>
            <label>长按阈值 (ms)
              <input id="durationMs" type="number" min="0" step="50" placeholder="仅长按时需要" />
            </label>
          </div>
          <div class="form-grid single">
            <label>动作类型
              <select id="actionType">
                <option value="run_shell">执行 Shell 命令</option>
                <option value="send_key">发送按键事件</option>
                <option value="launch_intent">启动 Intent</option>
              </select>
            </label>
          </div>
          <div class="form-grid single">
            <label id="fieldShell">Shell 命令
              <input id="command" type="text" placeholder='如：input keyevent 223 或 am start -a android.intent.action.ASSIST' />
            </label>
            <label id="fieldSendKey" class="hidden">要发送的 keyCode
              <input id="sendKeyCode" type="number" min="0" step="1" placeholder="例如：27" />
            </label>
            <label id="fieldIntent" class="hidden">Intent JSON
              <textarea id="intentJson" rows="6" placeholder='例如：{"action":"android.intent.action.VOICE_ASSIST"}'></textarea>
            </label>
          </div>
          <div class="actions">
            <button type="submit" id="btnSubmit">保存规则</button>
            <button type="button" id="btnCancel">取消编辑</button>
          </div>
          <p id="formError" class="error"></p>
        </form>
      </section>

      <pre id="status" class="status">Ready.</pre>
    </section>
  </main>

  <script src="bridge.js"></script>
  <script src="app.js"></script>
</body>
</html>
